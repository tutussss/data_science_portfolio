<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg">
<head>
  <meta charset="UTF-8" />
  <title>How to do it&#x2026;</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css" />
  <link type="text/css" rel="stylesheet" media="all" href="core.css" />
</head>
<body>
  <div id="sbo-rt-content"><section>

    <header>

      <h1 class="header-title">How to do itâ€¦</h1>

    </header>

    <article>

      <ol>

        <li>We are using a live connection, which means that each interaction with a report will generate an SQL query and we should wait. To avoid this, we will pause Tableau Auto Updates, as shown in the following screenshot:</li>

      </ol>

      <p class="CDPAlignCenter CDPAlign">

        <img class="aligncenter size-full wp-image-1321 image-border" src="images/d0f3295c-bd02-4767-9ca0-04844628dcd0.png" style="width:34.50em;height:7.92em;" />

      </p>

      <ol start="2">

        <li>Now, we can craft our report by dragging and dropping <span class="packt_screen">Dimensions</span> and <span class="packt_screen">Measures</span> to the canvas<span>, as follows</span>:</li>

      </ol>

      <p class="mce-root"></p>

      <ol start="3">

        <li>You should add the following filters:</li>

      </ol>

      <ul>

        <li style="padding-left: 30px;"><span class="packt_screen">C City</span>: <kbd>UNITED KI1</kbd> or <kbd>UNITED KI5</kbd></li>

        <li style="padding-left: 30px;"><span class="packt_screen">S City</span>: <kbd>UNITED KI1</kbd> or <kbd>UNITED KI5</kbd></li>

        <li style="padding-left: 30px;"><span class="packt_screen">D YEAR</span>:<span><span> </span></span><kbd>Dec1997</kbd></li>

      </ul>

      <p style="padding-left: 60px;">Moreover, we should convert <span class="packt_screen">D Year</span> into discrete and sort by <span class="packt_screen">Revenue</span>.</p>

      <ol start="4">

        <li>We should unpause auto updates and run our query. It takes ~18 seconds for my cluster. If we missed the time, we can log in to the <span class="packt_screen">AWS Console</span> and navigate to the <span class="packt_screen">Redshift cluster</span> | <span class="packt_screen">Queries Tab</span> and see all executed queries, their time, and plan. You might see that, in the case of Tableau, we don't have actual queries; instead, we have something like <span class="packt_screen">fetch 10000 in SQL_CUR7</span>. Tableau is using cursors and we can run the following query to see queries for currently active cursors:</li>

      </ol>

      <pre style="padding-left: 60px;">SELECT<br/>   usr.usename AS username<br/>  , min(cur.starttime) AS start_time<br/>  , DATEDIFF(second, min(cur.starttime), getdate()) AS run_time<br/>  , min(cur.row_count) AS row_count<br/>  , min(cur.fetched_rows) AS fetched_rows<br/>  , listagg(util_text.text)<br/>    WITHIN GROUP (ORDER BY sequence) AS query<br/>FROM STV_ACTIVE_CURSORS cur<br/>  JOIN stl_utilitytext util_text<br/>    ON cur.pid = util_text.pid AND cur.xid = util_text.xid<br/>  JOIN pg_user usr<br/>    ON usr.usesysid = cur.userid<br/>GROUP BY usr.usename, util_text.xid;</pre>

      <ol start="5">

        <li>Let's run one more system query that will help us to identify the size of tables we are using in our Tableau data source<span>, as follows</span>:</li>

      </ol>

      <pre style="padding-left: 60px;">select stv_tbl_perm.name as table, count(*) as mb from stv_blocklist, stv_tbl_perm<br/>where stv_blocklist.tbl = stv_tbl_perm.id<br/>and stv_blocklist.slice = stv_tbl_perm.slice and stv_tbl_perm.name in ('lineorder','part','dwdate','supplier')<br/>group by stv_tbl_perm.name<br/>order by 1 asc;</pre>

      <p style="padding-left: 60px;">We can notice the size of the tables:</p>

      <ul>

        <li style="padding-left: 30px;"><kbd>lineorder</kbd>=<kbd>34311mb</kbd></li>

        <li style="padding-left: 30px;"><kbd>part</kbd>=<kbd>92mb</kbd></li>

        <li style="padding-left: 30px;"><kbd>dwdate</kbd>=<kbd>80mb</kbd></li>

        <li style="padding-left: 30px;"><kbd>supplier</kbd>=<kbd>76mb</kbd></li>

      </ul>

      <p>Finally, we can tune our cluster to improve the performance of the queries.</p>

    </article>

  </section>

</div>
</body>
</html>